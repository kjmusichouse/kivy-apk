- name: ğŸ“¦ Install Android SDK & NDK
  run: |
    set -e

    SDK_DIR=$HOME/android-sdk
    CMD_TOOLS_ZIP=commandlinetools-linux-9477386_latest.zip
    CMD_TOOLS_URL=https://dl.google.com/android/repository/$CMD_TOOLS_ZIP

    echo "ğŸ“¦ Downloading Android command-line tools..."
    mkdir -p $SDK_DIR/cmdline-tools
    cd $SDK_DIR/cmdline-tools
    wget -q $CMD_TOOLS_URL

    echo "ğŸ“‚ Unzipping command-line tools..."
    unzip -q $CMD_TOOLS_ZIP
    rm $CMD_TOOLS_ZIP

    # Normalize folder structure
    if [ -d "cmdline-tools" ]; then
      echo "ğŸ“ Fixing nested folder structure..."
      mv cmdline-tools cmdline-tools-temp
      mkdir cmdline-tools
      mv cmdline-tools-temp cmdline-tools/cmdline-tools
    fi

    # Set env vars
    echo "ANDROID_HOME=$SDK_DIR" >> $GITHUB_ENV
    echo "ANDROID_SDK_ROOT=$SDK_DIR" >> $GITHUB_ENV
    echo "$SDK_DIR/cmdline-tools/cmdline-tools/bin" >> $GITHUB_PATH
    echo "$SDK_DIR/platform-tools" >> $GITHUB_PATH

    # Temporary export for current shell
    export PATH="$SDK_DIR/cmdline-tools/cmdline-tools/bin:$SDK_DIR/platform-tools:$PATH"

    echo "ğŸ§ª Checking sdkmanager..."
    echo "PATH = $PATH"
    ls -la $SDK_DIR/cmdline-tools/cmdline-tools/bin/
    if ! command -v sdkmanager; then
      echo "âŒ sdkmanager not found in PATH."
      exit 1
    fi

    sdkmanager --version || { echo "âŒ sdkmanager failed to run."; exit 1; }

    echo "âœ… sdkmanager is installed and working."
